[
    {
        "title": "$:/plugins/oeyoews/notebook-theme-sidebar-resizer",
        "type": "application/json",
        "created": "20231102190000000",
        "text": "{\"tiddlers\":{\"$:/plugins/oeyoews/notebook-theme-sidebar-resizer/readme\":{\"title\":\"$:/plugins/oeyoews/notebook-theme-sidebar-resizer/readme\",\"text\":\"!! Notebook theme sidebar resizer\\n\\n> support left/right sidebar resizer\\n\\n> 最初仅仅是为了支持 notebook theme 而写的 sidebar resizer, 后来开始支持 vanilla, captivate.\\n\\n<!-- 在切换主题时，theme 会覆盖掉同名非系统文件，所以需要手动修改 -->\\n\\n!! for captivate theme\\n\\nneed add `<$nbresizer />` in [[$:/themes/cdr/captivate/ui/SideBar]] tiddler.\\n\\n```html\\n<<sidebarTabs>>\\n<!-- here -->\\n<$nbresizer />\\n```\"},\"$:/themes/nico/notebook/ui/Sidebar/resizer\":{\"title\":\"$:/themes/nico/notebook/ui/Sidebar/resizer\",\"tags\":\"$:/themes/nico/notebook/tags/Sidebar $:/tags/SideBarSegment\",\"text\":\"<$nbresizer />\"},\"$:/plugins/oeyoews/notebook-theme-sidebar-resizer/default-sidebar-width\":{\"title\":\"$:/plugins/oeyoews/notebook-theme-sidebar-resizer/default-sidebar-width\",\"text\":\"300px\"},\"$:/plugins/oeyoews/notebook-theme-sidebar-resizer/locales/en.js\":{\"title\":\"$:/plugins/oeyoews/notebook-theme-sidebar-resizer/locales/en.js\",\"text\":\"/*\\\\\\ntitle: $:/plugins/oeyoews/notebook-theme-sidebar-resizer/locales/en.js\\ntype: application/javascript\\nmodule-type: library\\n\\nnotebook-theme-sidebar-resizer locale en\\n\\\\*/\\n\\nmodule.exports = {\\n  pluginname: 'notebook-theme-sidebar-resizer',\\n  warning:\\n    \\\"[notebook-theme-sidebar-resizer]: requires the 'tiddlywiki/tailwindcss-plus' plugin to be installed\\\",\\n};\\n\",\"type\":\"application/javascript\",\"module-type\":\"library\"},\"$:/plugins/oeyoews/notebook-theme-sidebar-resizer/locales/zh.js\":{\"title\":\"$:/plugins/oeyoews/notebook-theme-sidebar-resizer/locales/zh.js\",\"text\":\"/*\\\\\\ntitle: $:/plugins/oeyoews/notebook-theme-sidebar-resizer/locales/zh.js\\ntype: application/javascript\\nmodule-type: library\\n\\nnotebook-theme-sidebar-resizer locale zh\\n\\\\*/\\n\\nmodule.exports = {\\n  pluginname: '侧边栏宽度调整插件',\\n  warning: '需要安装 tailwindcss',\\n};\\n\",\"type\":\"application/javascript\",\"module-type\":\"library\"},\"$:/plugins/oeyoews/notebook-theme-sidebar-resizer/style.css\":{\"title\":\"$:/plugins/oeyoews/notebook-theme-sidebar-resizer/style.css\",\"text\":\".oresizer-left {\\n  left: 0;\\n}\\n.oresizer-right {\\n  right: 0;\\n}\\n\\n.oresizer {\\n  width: 5px;\\n  border-radius: 5px;\\n  height: 100%;\\n  position: absolute;\\n  top: 0;\\n  background-color: #f3f4f6;\\n}\\n\\n.oresizer:hover {\\n  cursor: e-resize;\\n  background-color: #e5e7eb;\\n  transition: all;\\n}\\n\\n.dark .oresizer {\\n  background-color: #6b7280;\\n}\\n.dark .oresizer:hover {\\n  background-color: #4b5563;\\n}\\n\",\"type\":\"text/css\",\"tags\":\"$:/tags/Stylesheet\"},\"$:/plugins/oeyoews/notebook-theme-sidebar-resizer/widget.js\":{\"title\":\"$:/plugins/oeyoews/notebook-theme-sidebar-resizer/widget.js\",\"text\":\"/*\\\\\\ntitle: $:/plugins/oeyoews/notebook-theme-sidebar-resizer/widget.js\\ntype: application/javascript\\nmodule-type: widget\\n\\nnotebook-theme-sidebar-resizer widget\\n\\\\*/\\n\\nconst { widget: Widget } = require('$:/core/modules/widgets/widget.js');\\nconst en = require('./locales/en');\\n\\nclass NotebookResizer extends Widget {\\n  constructor(parseTreeNode, options) {\\n    super(parseTreeNode, options);\\n    this.VANILLA = 'vanilla';\\n    this.NOTEBOOK = 'notebook';\\n    this.themeTiddler = '$:/theme';\\n    this.theme = null;\\n    this.sidebarLayoutTiddler =\\n      '$:/themes/tiddlywiki/vanilla/options/sidebarlayout';\\n    this.isResizing = false;\\n    this.notebookWidthTiddler = '$:/themes/nico/notebook/metrics/sidebar-width';\\n    this.vanillaWidthTiddler =\\n      '$:/themes/tiddlywiki/vanilla/metrics/sidebarwidth';\\n    this.positionTiddler = '$:/themes/nico/notebook/metrics/sidebar-position';\\n    this.notebookStateSidebar = '$:/state/notebook-sidebar';\\n    this.vanillaStateSidebar = '$:/state/sidebar';\\n    this.defaultTiddler =\\n      '$:/plugins/oeyoews/notebook-theme-sidebar-resizer/default-sidebar-width';\\n    this.width = 0;\\n  }\\n\\n  render(parent, nextSibling) {\\n    if (!$tw.browser) return;\\n    this.parentDomNode = parent;\\n    this.computeAttributes();\\n    this.execute();\\n\\n    // this.checker();\\n    // update theme\\n    const theme = this.checkTheme();\\n    this.theme = theme;\\n    // after update this.theme\\n    this.presetForVanillaTheme();\\n\\n    const createElement = $tw.utils.domMaker;\\n\\n    // NOTE: Tailwindcss class here, if you dont want install the extra tailwindcss dependency, you can rewrite it use general style()\\n    const resizer = createElement('div', {\\n      class: 'oresizer',\\n    });\\n\\n    if (this.getSidebarPosition() === 'left') {\\n      resizer.classList.add('oresizer-right');\\n    } else {\\n      resizer.classList.add('oresizer-left');\\n    }\\n\\n    resizer.addEventListener('pointerdown', (e) => {\\n      e.preventDefault(); // prevent select text on move sidebar width\\n\\n      this.isResizing = true;\\n      document.addEventListener('pointermove', (e) => this.resize(e));\\n      document.addEventListener('pointerup', (e) => this.stopResize(e));\\n    });\\n\\n    parent.insertBefore(resizer, nextSibling);\\n    this.domNodes.push(resizer);\\n  }\\n\\n  checkTheme() {\\n    const currentTiddler = $tw.wiki.getTiddlerText(this.themeTiddler);\\n    if (\\n      currentTiddler === '$:/themes/nico/notebook' ||\\n      currentTiddler === '$:/themes/oeyoews/notebook-plus' // for my custom notebook theme\\n    ) {\\n      return this.NOTEBOOK;\\n    }\\n    return this.VANILLA;\\n  }\\n\\n  presetForVanillaTheme() {\\n    const sidebarLayout = $tw.wiki.getTiddlerText(this.sidebarLayoutTiddler);\\n    if (this.theme === this.VANILLA) {\\n      if (sidebarLayout !== 'fluid-fixed') {\\n        console.warn('you should set sidebar layout to fluid-fixed');\\n        $tw.wiki.setText(this.sidebarLayoutTiddler, null, null, 'fluid-fixed');\\n      }\\n    }\\n  }\\n\\n  getSidebarPosition() {\\n    // NOTE: before vanilla adjust\\n    if (\\n      $tw.wiki.getTiddlerText(this.themeTiddler) === '$:/themes/cdr/captivate'\\n    ) {\\n      return 'left';\\n    }\\n\\n    if (this.theme === this.VANILLA) {\\n      return 'right';\\n    }\\n\\n    if (!$tw.wiki.tiddlerExists(this.positionTiddler)) {\\n      return 'left';\\n    }\\n\\n    const { position = 'left' } = $tw.wiki.getTiddler(\\n      this.positionTiddler,\\n    ).fields;\\n\\n    return position;\\n  }\\n\\n  getDefaultSidebarWidth() {\\n    return $tw.wiki.getTiddlerText(this.defaultTiddler).replace('px', '');\\n  }\\n\\n  resize(e) {\\n    const clientX = e.clientX;\\n    if (this.isResizing) {\\n      if (this.getSidebarPosition() === 'left') {\\n        this.width = clientX;\\n      } else {\\n        this.width = window.innerWidth - clientX;\\n      }\\n      if (this.width / window.innerWidth > 0.75) {\\n        return;\\n      }\\n      if (this.width / window.innerWidth < 0.05) {\\n        this.closeSidebar();\\n        this.isResizing = false;\\n        return;\\n      }\\n      this.updateSidebarWidth(this.width);\\n    }\\n  }\\n\\n  stopResize(e) {\\n    this.isResizing = false;\\n    document.removeEventListener('pointermove', (e) => this.resize(e));\\n  }\\n\\n  closeSidebar() {\\n    const stateTiddler =\\n      this.theme === this.NOTEBOOK\\n        ? this.notebookStateSidebar\\n        : this.vanillaStateSidebar;\\n    $tw.wiki.setText(stateTiddler, 'text', null, 'no');\\n    this.updateSidebarWidth(this.getDefaultSidebarWidth());\\n  }\\n\\n  updateSidebarWidth(width) {\\n    const targetTiddler =\\n      this.theme === this.NOTEBOOK\\n        ? this.notebookWidthTiddler\\n        : this.vanillaWidthTiddler;\\n    requestAnimationFrame(() => {\\n      $tw.wiki.setText(\\n        targetTiddler,\\n        null,\\n        null,\\n        `${Number(width).toFixed(0)}px`,\\n      );\\n    });\\n  }\\n\\n  checker() {\\n    const logger = new $tw.utils.Logger(en.pluginname);\\n    if (!$tw.modules.titles['tailwindcss.min.js']) {\\n      logger.alert(en.warning);\\n    }\\n  }\\n\\n  refresh(changedTiddlers) {\\n    // TODO: refresh on change tw languages\\n    const tiddlers = Object.keys(changedTiddlers);\\n    if (\\n      tiddlers.includes(this.positionTiddler) ||\\n      tiddlers.includes('$:/language') ||\\n      tiddlers.includes('$:/layout') ||\\n      tiddlers.includes(this.themeTiddler) ||\\n      tiddlers.includes(this.sidebarLayoutTiddler)\\n    ) {\\n      this.refreshSelf();\\n      return true;\\n    }\\n    return false;\\n  }\\n}\\n\\nexports.nbresizer = NotebookResizer;\\n\",\"type\":\"application/javascript\",\"module-type\":\"widget\"}}}",
        "description": "notebook-theme-sidebar-resizer",
        "author": "oeyoews",
        "version": "0.1.7",
        "core-version": ">=5.3.0",
        "plugin-type": "plugin",
        "name": "notebook theme sidebar resizer",
        "meat#disabled": "yes",
        "plugin-priority": "100",
        "qrcode": "yes",
        "list": "readme",
        "dependents": ""
    }
]